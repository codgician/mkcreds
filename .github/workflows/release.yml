name: Release
on:
  push:
    tags:
      - "v*"
permissions:
  contents: write
jobs:
  release:
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - name: Download artifacts from build workflow
        uses: dawidd6/action-download-artifact@v6
        with:
          workflow: build.yml
          commit: ${{ github.sha }}
          path: artifacts
      - name: Prepare release assets
        run: |
          mkdir -p release
          for dir in artifacts/*/; do
            name=$(basename "$dir")
            cp "$dir/mkcreds" "release/$name"
            chmod +x "release/$name"
          done
          cd release
          for file in mkcreds-*; do
            sha256sum "$file" > "$file.sha256"
          done
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          generate_release_notes: true
          files: |
            release/mkcreds-x86_64-linux
            release/mkcreds-x86_64-linux.sha256
            release/mkcreds-aarch64-linux
            release/mkcreds-aarch64-linux.sha256
